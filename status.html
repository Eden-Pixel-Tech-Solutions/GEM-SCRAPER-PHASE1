<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraper Status Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', args, sans-serif; background-color: #1e1e1e; color: #e0e0e0; margin: 0; padding: 20px; }
        h1 { color: #61afef; border-bottom: 2px solid #3e4451; padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .card { background: #282c34; padding: 15px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .card h2 { margin: 0 0 10px 0; font-size: 1rem; color: #98c379; }
        .card .value { font-size: 1.5rem; font-weight: bold; }
        .logs-container { background: #000; padding: 15px; border-radius: 8px; height: 400px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 0.9rem; border: 1px solid #3e4451; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .log-level-INFO { color: #98c379; }
        .log-level-WARNING { color: #e5c07b; }
        .log-level-ERROR { color: #e06c75; }
        .status-running { color: #98c379; }
        .status-shutdown { color: #e06c75; }
    </style>
</head>
<body>
    <h1>Real-Time Scraper Status</h1>
    
    <div class="grid">
        <div class="card">
            <h2>State</h2>
            <div class="value" id="state">Loading...</div>
        </div>
        <div class="card">
            <h2>Progress</h2>
            <div class="value"><span id="page_no">0</span> / <span id="total_pages">0</span> Pages</div>
        </div>
        <div class="card">
            <h2>Records Found</h2>
            <div class="value" id="total_records">0</div>
        </div>
        <div class="card">
            <h2>Items Committed</h2>
            <div class="value" id="items_committed">0</div>
        </div>
        <div class="card">
            <h2>Total DB Rows</h2>
            <div class="value" id="db_count">0</div>
        </div>
    </div>

    <h3>Live Logs</h3>

    <div class="logs-container" id="logs">
        <!-- Logs will appear here -->
    </div>

    <script>
        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('state').innerText = data.state;
                    document.getElementById('state').className = 'value status-' + data.state.toLowerCase();
                    document.getElementById('page_no').innerText = data.page_no;
                    document.getElementById('total_pages').innerText = data.total_pages;
                    document.getElementById('total_records').innerText = data.total_records;
                    document.getElementById('items_committed').innerText = data.items_committed;
                    document.getElementById('db_count').innerText = data.db_count;
                    
                    const logsDiv = document.getElementById('logs');

                    logsDiv.innerHTML = data.logs.map(line => {
                         let levelClass = 'log-level-INFO';
                         if (line.includes('[WARNING]')) levelClass = 'log-level-WARNING';
                         if (line.includes('[ERROR]') || line.includes('[CRITICAL]')) levelClass = 'log-level-ERROR';
                         return `<div class="log-entry ${levelClass}">${line}</div>`;
                    }).join('');
                    
                    // Auto scroll to bottom if near bottom
                    // logsDiv.scrollTop = logsDiv.scrollHeight; 
                });
        }
        setInterval(updateStatus, 2000);
        updateStatus();
    </script>
</body>
</html>
